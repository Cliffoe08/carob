# R script for "carob"
# license: GPL (>=3)


carob_script <- function(path) {

"
TAMASA Ethiopia. Yield, soil and agronomy data from farmersâ€™ maize fields collected by CSA,  2015 season

This files ontains yiedl and soils data coillected by CSA (Central Statistical Agency)  from four  zones in Oromia (East Showa, Wollega, West and South West Showa and Jimma) and one Zone in Amhara (West Gojjam). A total of 38 primary sampling units were covered and making a total of 383 sampling points. Unreplicated crop cuts were made on farmers maize fields and yield measured. Soil samples were also collected at 0-20 and 20-50cm but are not all analysed yet.
"

	uri <- "hdl:11529/11014"
	group <- "survey"
	ff  <- carobiner::get_data(uri, path, group)

	meta <- carobiner::get_metadata(uri, path, group, major=2, minor=1,
		data_organization = "CIMMYT;ESS",
		publication = NA,
		project = "TAMASA",
		data_type = "survey",
		treatment_vars = "none",
		response_vars = "none", 
		completion = 100,
		carob_contributor = "Mitchelle Njukuya",
		carob_date = "2025-08-05",
		notes = NA,
		design = NA
	)
	
	f <- ff[basename(ff) == "TAMASA_ET_CC_2015_CSAF.xlsx"]
	r <- carobiner::read.excel(f,sheet = "Revised_data")

	d <- data.frame(
	  country = "Ethiopia",
	  crop= "maize",
	  variety_type = r$`Type of variety`,
	  variety = r$`Name of variety`,
	  OM_used = r$`Fertilizer type/organic`,
	  OM_amount = r$`amount of organic fertilizer`,
	  fertilizer_used = r$`Fertilizer type/inorganic`,
	  fertilizer_amount = r$`amount of Inorganic fertilizer`,
	  plant_density = r$`Number of crop stands /16m2`*625,
	  cob_density = r$`Number of cobs/16m2`*625,
	  yield = r$`Moisture adjusted grain  yield (kg /ha)`,
	  yield_moisture = 14,
	  yield_isfresh = TRUE,
	  yield_part = "grain",
      crop_cut = TRUE,
	  plot_area = r$`Field area (ha)`,
	  soil_SOC = r$`Carbon (%)`,
	  soil_pH = r$pH,
	  soil_Al = r$`Al (mg/kg)`,
	  soil_Ca = r$`Ca  (mg/kg)`,
	  soil_S = r$`S  (mg/kg)`,
	  soil_Mn = r$`Mn  (mg/kg)`,
	  soil_P_total = r$`P  (mg/kg)`,
	  soil_Zn = r$`Zn  (mg/kg)`,
	  soil_K = r$`K  (mg/kg)`,
	  soil_Na = r$`Na  (mg/kg)`,
	  soil_Fe = r$`Fe  (mg/kg)`,
	  soil_B = r$`Boron  (mg/kg)`,
	  soil_N = r$`Nitrogen (%)`*10000,
	  depth_top = 0,
	  depth_bottom = 20
	)

	  
	d$trial_id <- as.character(1:nrow(d))
	
	d$on_farm <- TRUE
	d$is_survey <- TRUE
	d$irrigated <- FALSE

	d$planting_date <- "2015"
	d$harvest_date  <- "2016"
	
	d$variety <- gsub("\r\n", "", d$variety)
	d$variety <- gsub("BH- 660|Bh-660","BH-660",d$variety)
	d$variety <- trimws(d$variety)

	d$P_fertilizer <- d$K_fertilizer <- d$N_fertilizer <- d$S_fertilizer <- as.numeric(NA)
	d$fertilizer_type <- as.character(NA)
	d$fertilizer_amount[d$fertilizer_amount == "."] <- NA 
	d$fertilizer_amount <- as.numeric(d$fertilizer_amount)
	d$fertilizer_amount[d$fertilizer_amount > 1000] <- NA


	d$longitude = c(36.596, 36.6, 36.603, 36.588, 36.591,  36.599, 36.6, 36.601, 36.602, 36.601, 36.561, 36.566, 36.555,  36.566, 36.568, 36.567, 36.562, 36.558, 36.562, 35.715, 35.723,  35.726, 35.708, 35.717, 35.727, 35.723, 35.73, 35.722, 35.713,  36.442, 36.442, 36.443, 36.565, 36.443, 36.438, 36.44, 37.627,  37.624, 37.632, 37.626, 37.621, 37.614, 37.614, 37.622, 37.626,  37.613, 39.055, 39.05, 39.048, 39.049, 39.056, 39.049, 39.049,  39.053, 39.054, 39.049, 36.575, 36.574, 36.573, 36.561, 36.564,  36.563, 36.58, 36.577, 36.573, 36.558, 36.443, 36.442, 36.441,  36.447, 35.978, 35.975, 35.978, 35.976, 35.987, 35.989, 35.977,  35.988, 35.977, 35.987, 37.035, 37.015, 37.028, 37.036, 37.039,  37.043, 37.037, 37.024, 37.031, 37.025, 37.422, 37.439, 37.439,  37.428, 37.435, 37.435, 37.438, 37.449, 37.424, 37.439, 36.975,  36.968, 36.972, 36.973, 36.967, 36.975, 36.96, 36.97, 36.974,  36.971, 38.997, 38.998, 38.993, 38.996, 38.996, 38.996, 38.994,  38.998, 38.99, 38.996, 37.863, 37.866, 37.862, 37.852, 37.863,  37.85, 37.852, 37.85, 37.857, 37.85, 37.207, 37.208, 37.209,  37.209, 37.192, 37.208, 37.194, 37.211, 37.189, 37.201, 37.073,  37.072, 37.071, 37.069, 37.066, 37.09, 37.08, 37.082, 37.072,  37.076, 36.89, 36.906, 36.911, 36.915, 36.908, 36.905, 36.898,  36.901, 36.899, 36.887, 35.995, 35.992, 35.994, 35.99, 35.989,  35.989, 35.99, 35.987, 35.989, 35.992, 37.369, 37.359, 37.358,  37.366, 37.37, 37.363, 37.369, 37.37, 37.355, 37.363, 36.321,  36.321, 36.356, 36.326, 36.341, 36.338, 36.334, 36.333, 36.339,  36.325, 37.26, 37.264, 37.277, 37.268, 37.26, 37.259, 37.267,  37.264, 37.261, 37.269, 38.701, 38.706, 38.706, 38.703, 38.712,  38.709, 38.712, 38.715, 38.708, 38.708, 38.758, 38.758, 38.75,  38.751, 38.751, 38.75, 38.755, 38.751, 38.757, 38.763, 39.084,  39.087, 39.074, 39.08, 39.079, 39.081, 39.08, 39.08, 39.074,  39.079, 37.181, 37.211, 37.209, 37.185, 37.187, 37.177, 37.191,  37.211, 37.186, 37.183, 36.624, 36.614, 36.627, 36.61, 36.624,  36.625, 36.61, 36.622, 36.612, 36.61, 38.765, 38.764, 38.763,  38.769, 38.766, 38.771, 38.772, 38.759, 38.765, 38.755, 36.202,  36.2, 36.217, 36.204, 36.204, 36.205, 36.203, 36.205, 36.207,  36.202, 37.929, 37.929, 37.927, 37.928, 37.929, 37.918, 37.916,  37.929, 37.914, 37.915, 35.741, 35.737, 35.729, 35.736, 35.726,  35.722, 35.74, 35.741, 35.734, 35.726, 36.6, 36.606, 36.603,  36.615, 36.611, 36.597, 36.611, 36.599, 36.616, 36.6, 40.588,  40.589, 36.339, 36.34, 36.344, 36.341, 36.336, 36.352, 36.342,  36.346, 36.348, 36.344, 35.328, 35.329, 35.334, 35.342, 35.332,  35.324, 35.335, 35.324, 35.334, 35.327, 35.625, 35.618, 35.612,  35.614, 35.625, 35.618, 35.609, 35.624, 35.609, 35.61, 37.888,  37.894, 37.745, 37.896, 37.743, 37.741, 37.902, 37.67, 37.671,  37.664, 37.66, 37.737, 37.666, 37.736, 37.9, 37.742, 37.896,  37.895, 37.747, 37.661, 37.661, 37.66, 37.745, 37.895, 37.739,  37.666, 37.898, 37.896, 37.748, 37.667, 37.335, 37.339, 37.347,  37.349, 37.345, 37.343, 37.345, 37.337, 37.347, 37.346, 37.343,  37.354, 37.354, 37.336, 37.349, 37.338, 37.346, 37.346, 37.352,  37.355)
 
	d$latitude = c(8.708, 8.704, 8.687, 8.693, 8.693, 8.698,  8.695, 8.696, 8.703, 8.696, 7.942, 7.937, 7.927, 7.94, 7.937,  7.942, 7.942, 7.917, 7.941, 9.171, 9.166, 9.17, 9.178, 9.175,  9.165, 9.178, 9.173, 9.181, 9.169, 7.951, 7.952, 7.949, 7.946,  7.948, 7.951, 7.951, 8.41, 8.388, 8.384, 8.396, 8.39, 8.394,  8.391, 8.399, 8.396, 8.397, 8.663, 8.67, 8.656, 8.658, 8.662,  8.658, 8.658, 8.665, 8.664, 8.658, 8.469, 8.47, 8.47, 8.48, 8.467,  8.467, 8.471, 8.47, 8.471, 8.478, 7.953, 7.957, 7.951, 7.949,  8.331, 8.338, 8.336, 8.335, 8.33, 8.331, 8.345, 8.331, 8.336,  8.332, 10.707, 10.714, 10.718, 10.709, 10.724, 10.714, 10.715,  10.718, 10.708, 10.72, 8.975, 8.968, 8.969, 8.971, 8.971, 8.972,  8.969, 8.966, 8.96, 8.97, 10.615, 10.627, 10.623, 10.623, 10.619,  10.623, 10.631, 10.622, 10.62, 10.625, 8.622, 8.635, 8.634, 8.639,  8.633, 8.634, 8.63, 8.633, 8.631, 8.639, 8.643, 8.632, 8.637,  8.639, 8.642, 8.639, 8.636, 8.643, 8.64, 8.642, 8.66, 8.675,  8.674, 8.658, 8.658, 8.649, 8.657, 8.65, 8.655, 8.662, 9.082,  9.086, 9.092, 9.088, 9.091, 9.101, 9.105, 9.104, 9.094, 9.101,  11.582, 11.583, 11.575, 11.592, 11.578, 11.576, 11.579, 11.579,  11.578, 11.581, 8.314, 8.318, 8.313, 8.311, 8.305, 8.305, 8.311,  8.303, 8.316, 8.32, 11.396, 11.382, 11.383, 11.396, 11.384, 11.384,  11.384, 11.398, 11.384, 11.39, 8.016, 8.016, 8.039, 8.02, 8.036,  8.035, 8.02, 8.022, 8.038, 8.015, 8.017, 8.027, 8.028, 8.031,  8.022, 8.021, 8.016, 8.028, 8.019, 8.033, 7.281, 7.281, 7.281,  7.28, 7.274, 7.276, 7.275, 7.277, 7.275, 7.273, 7.252, 7.224,  7.257, 7.257, 7.256, 7.255, 7.235, 7.289, 7.241, 7.226, 8.6,  8.599, 8.59, 8.601, 8.6, 8.6, 8.605, 8.601, 8.591, 8.599, 10.677,  10.691, 10.673, 10.643, 10.649, 10.689, 10.652, 10.68, 10.644,  10.666, 9.535, 9.538, 9.533, 9.536, 9.536, 9.536, 9.526, 9.538,  9.523, 9.539, 7.109, 7.107, 7.107, 7.105, 7.102, 7.101, 7.101,  7.112, 7.106, 7.11, 9.356, 9.356, 9.357, 9.354, 9.356, 9.351,  9.357, 9.352, 9.353, 9.355, 8.518, 8.52, 8.518, 8.52, 8.518,  8.518, 8.514, 8.516, 8.509, 8.507, 8.847, 8.837, 8.848, 8.848,  8.85, 8.851, 8.844, 8.845, 8.842, 8.851, 8.774, 8.771, 8.771,  8.77, 8.766, 8.77, 8.772, 8.784, 8.775, 8.78, 8.602, 8.602, 8.485,  8.486, 8.488, 8.486, 8.49, 8.484, 8.49, 8.486, 8.486, 8.495,  9.681, 9.687, 9.693, 9.689, 9.686, 9.687, 9.69, 9.687, 9.688,  9.685, 8.975, 8.979, 8.976, 8.985, 8.985, 8.989, 8.974, 8.977,  8.98, 8.969, 10.236, 10.245, 10.076, 10.255, 10.068, 10.063,  10.257, 10.387, 10.386, 10.399, 10.399, 10.06, 10.401, 10.056,  10.255, 10.063, 10.254, 10.264, 10.07, 10.397, 10.397, 10.398,  10.071, 10.25, 10.061, 10.41, 10.26, 10.247, 10.07, 10.401, 9.04,  9.044, 9.034, 9.03, 9.036, 9.035, 9.021, 9.028, 9.022, 9.04,  7.711, 7.697, 7.699, 7.71, 7.698, 7.71, 7.694, 7.704, 7.703,  7.697)
 
	d$elevation = c(2446, 2440, 2359, 2434, 2420, 2437, 2437,  2466, 2441, 2474, 1671, 1569, 1621, 1559, 1586, 1568, 1650, 1712,  1647, 1891, 1826, 1823, 1879, 1908, 1807, 1887, 1742, 1888, 1888,  2264, 2274, 2279, 1590, 2282, 2227, 2258, 1634, 1641, 1590, 1670,  1619, 1674, 1664, 1664, 1649, 1688, 1858, 1868, 1880, 1887, 1858,  1896, 1881, 1850, 1858, 1885, 1636, 1612, 1627, 1555, 1561, 1574,  1622, 1596, 1611, 1546, 2259, 2214, 2256, 2236, 1984, 1964, 1975,  1982, 2026, 2034, 1963, 2031, 1984, 2020, 2094, 2075, 2094, 2088,  2130, 2106, 2121, 2102, 2078, 2082, 1937, 2135, 2145, 2050, 2128,  2059, 2153, 2197, 2058, 2133, 1972, 1996, 1990, 2001, 1980, 1982,  2030, 2009, 1992, 1985, 2071, 2060, 2061, 2008, 2049, 2046, 2083,  2064, 2097, 1990, 2257, 2189, 2248, 2306, 2258, 2300, 2289, 2313,  2249, 2300, 1704, 1712, 1704, 1694, 1642, 1606, 1647, 1622, 1634,  1720, 1589, 1603, 1638, 1622, 1605, 1620, 1648, 1633, 1620, 1650,  2076, 2049, 2072, 2073, 2054, 2058, 2076, 2063, 2074, 2111, 2055,  2017, 2033, 1981, 2016, 2014, 1968, 2030, 1998, 2012, 2184, 2136,  2120, 2172, 2110, 2122, 2103, 2173, 2115, 2129, 1894, 1890, 1961,  1919, 2121, 2116, 1968, 1983, 2119, 1875, 2056, 2075, 2283, 2210,  2065, 2040, 2089, 2082, 2061, 2160, 2080, 2074, 2077, 2075, 2084,  2092, 2099, 2102, 2087, 2093, 2167, 2315, 2177, 2174, 2171, 2168,  2215, 2121, 2213, 2352, 1793, 1781, 1773, 1810, 1786, 1781, 1790,  1776, 1772, 1783, 1979, 1979, 1919, 1851, 1856, 1986, 1857, 1937,  1851, 1921, 1378, 1373, 1346, 1364, 1363, 1353, 1343, 1367, 1313,  1370, 2586, 2595, 2598, 2611, 2594, 2618, 2633, 2540, 2605, 2545,  1376, 1357, 1398, 1369, 1386, 1358, 1367, 1365, 1364, 1373, 1966,  1960, 1971, 1958, 1962, 1945, 1952, 1954, 1952, 1948, 1843, 1878,  1859, 1842, 1863, 1842, 1859, 1862, 1886, 1851, 2190, 2280, 2244,  2290, 2305, 2195, 2279, 2154, 2252, 2156, 1224, 1234, 1936, 1929,  1903, 1932, 1964, 1922, 1944, 1922, 1926, 1901, 1628, 1668, 1658,  1683, 1672, 1613, 1689, 1675, 1686, 1642, 1824, 1845, 1792, 1782,  1862, 1793, 1786, 1846, 1777, 1782, 2445, 2406, 2298, 2438, 2305,  2312, 2387, 2327, 2321, 2287, 2294, 2316, 2314, 2294, 2413, 2303,  2427, 2520, 2328, 2294, 2253, 2276, 2306, 2435, 2311, 2412, 2428,  2431, 2318, 2339, 1887, 1927, 1905, 1881, 1908, 1907, 1841, 1884,  1845, 1936, 1813, 1876, 1855, 1775, 1857, 1801, 1857, 1794, 1829,  1871)  


	d$geo_from_source <- TRUE
   
	carobiner::write_files(path, meta, d)
}

